<!DOCTYPE html>
<html>
<head>
    <title>API Test</title>
</head>
<body>
    <h1>API Test</h1>
    <button onclick="testAPI()">Test API</button>
    <div id="result"></div>

    <script>
        // Try JSONP to bypass the redirect bug
        function testAPIWithJSONP() {
            console.log('üß™ Testing API with JSONP to bypass redirect...');
            
            const script = document.createElement('script');
            const callbackName = 'jsonp_callback_' + Date.now();
            
            // Create global callback
            window[callbackName] = function(data) {
                console.log('üìä JSONP Data received:', data);
                document.getElementById('result').innerHTML = `‚úÖ JSONP SUCCESS: Found ${data.count} songs!`;
                document.getElementById('result').style.color = 'green';
                
                // Cleanup
                document.head.removeChild(script);
                delete window[callbackName];
            };
            
            // Create script tag with callback
            script.src = `https://script.google.com/macros/s/AKfycbwDOCzwClNGd7zhFzHlkRmssv5nJ_Cw-C_GtadYB_8UEXCB5wItTpTRK23Vsx9Qvfcs/exec?callback=${callbackName}`;
            script.onerror = function() {
                console.error('‚ùå JSONP failed');
                document.getElementById('result').innerHTML = '‚ùå JSONP failed';
                document.getElementById('result').style.color = 'red';
                document.head.removeChild(script);
                delete window[callbackName];
            };
            
            document.head.appendChild(script);
        }

        async function testAPI() {
            console.log('üß™ Testing both fetch and JSONP...');
            console.log('üåê Origin:', window.location.origin);
            
            // Try fetch first
            try {
                const apiUrl = 'https://script.google.com/macros/s/AKfycbwDOCzwClNGd7zhFzHlkRmssv5nJ_Cw-C_GtadYB_8UEXCB5wItTpTRK23Vsx9Qvfcs/exec';
                console.log('üöÄ Trying fetch first:', apiUrl);
                
                const response = await fetch(apiUrl);
                const data = await response.json();
                console.log('üìä Fetch success:', data);
                document.getElementById('result').innerHTML = `‚úÖ FETCH SUCCESS: Found ${data.count} songs!`;
                document.getElementById('result').style.color = 'green';
            } catch (error) {
                console.log('‚ùå Fetch failed, trying JSONP:', error.message);
                testAPIWithJSONP();
            }
        }
    </script>
</body>
</html>
